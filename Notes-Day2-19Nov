Start the Lab

# sudo su -

# kubectl get nodes

demo1: recreate Deployment Strategy:

# vim deployment-recreate.yml

apiVersion: apps/v1
kind: Deployment
metadata:
 name: mydeploy
spec:
 replicas: 3
 strategy:
  type: Recreate
 selector:
  matchLabels:
   app: kubeserve
 template:
  metadata:
   labels:
    app: kubeserve
  spec:
   containers:
    - name: app
      image: leaddevops/kubeserve:v1



29  kubectl create -f recreate-deployment.yml
   33  kubectl get all
   35  kubectl get deployment -o wide
   36  kubectl set image deployment mydeploy app=leaddevops/kubeserve:v2

  37  kubectl get all
   38  kubectl get deployment -o wide


Demo2: Rolling update Deployment

===============================

# kubectl delete all --all

Create the deployment and service object

...

kubectl create -f https://raw.githubusercontent.com/Sonal0409/Vodafone-Kubernetes-Notes/main/Day2-Notes/Deployment/deployment.yml
...

kubectl get deployment
kubectl get service
kubectl get pods
kubectl scale deployment kubeserve --replicas=5
kubectl get pods
kubectl scale deployment kubeserve --replicas=2
Change the Image

kubectl set image deployment kubeserve app=leaddevops/kubeserve:v2
kubectl rollout status
kubectl set image deployment kubeserve app=leaddevops/kubeserve:v3
kubectl rollout status deployment kubeserve
V3 is faulty.. so rollback to previous version

kubectl rollout undo deployment kubeserve
kubectl rollout history deployment kubeserve
kubectl rollout history deployment kubeserve --revision=3
Note:
Run the loop to send continous request to service object

Go to worker node and execute below command:

while true;do curl serviceClusterIP:80;sleep 1;echo"";done

example: while true;do curl 10.102.253.113:80;sleep 1;echo"";done









